<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;
  background: black;
  font-family: Arial, sans-serif;
}

.game {
  position: relative;
  width: 100vw;
  height: 100vh;
  background: url("bg.jpg") no-repeat center center;
  background-size: contain;
}

/* Cells */
.cell {
  position: absolute;
  width: 10.18%;
  height: 5.73%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 6vw;
  font-weight: bold;
  color: white;
  cursor: pointer;
}

/* Status Text */
#status {
  position: absolute;
  top: 5%;
  width: 100%;
  text-align: center;
  font-size: 5vw;
  color: white;
  font-weight: bold;
  text-shadow: 0 0 10px black;
}

/* Play Again Button */
#restart {
  position: absolute;
  bottom: 12%; /* moved higher for visibility */
  left: 50%;
  transform: translateX(-50%);
  padding: 12px 25px;
  font-size: 16px;
  border: none;
  border-radius: 20px;
  background: rgba(0,0,0,0.7);
  color: white;
  display: none;
  cursor: pointer;
  z-index: 10;
  min-width: 120px;
}
</style>
</head>
<body>

<div class="game">

<div id="status">You choose</div>

<!-- Row 1 -->
<div class="cell" style="left:32.5%; top:28.8%;" onclick="playerMove(0)"></div>
<div class="cell" style="left:46.0%; top:28.0%;" onclick="playerMove(1)"></div>
<div class="cell" style="left:57.9%; top:26.6%;" onclick="playerMove(2)"></div>

<!-- Row 2 -->
<div class="cell" style="left:34.9%; top:35.3%;" onclick="playerMove(3)"></div>
<div class="cell" style="left:47.9%; top:35.8%;" onclick="playerMove(4)"></div>
<div class="cell" style="left:59.8%; top:33.1%;" onclick="playerMove(5)"></div>

<!-- Row 3 -->
<div class="cell" style="left:36.4%; top:41.6%;" onclick="playerMove(6)"></div>
<div class="cell" style="left:48.9%; top:41.0%;" onclick="playerMove(7)"></div>
<div class="cell" style="left:60.4%; top:39.9%;" onclick="playerMove(8)"></div>

<button id="restart" onclick="restartGame()">Play Again</button>

</div>

<script>
let board = ["","","","","","","","",""];
let gameActive = true;
let playerTurn = true; // Flag to prevent fast-tap glitch

const statusText = document.getElementById("status");
const restartBtn = document.getElementById("restart");

const winConditions = [
  [0,1,2],[3,4,5],[6,7,8],
  [0,3,6],[1,4,7],[2,5,8],
  [0,4,8],[2,4,6]
];

function playerMove(index){
  if(board[index] !== "" || !gameActive || !playerTurn) return; // prevent fast taps

  playerTurn = false; // disable further taps until computer moves
  makeMove(index, "X");

  if(!gameActive) return; // stop if player won

  // Computer thinking
  statusText.innerText = "Computer choosing...";
  setTimeout(() => {
    if(gameActive){
      computerMove();
      if(gameActive) statusText.innerText = "You choose";
      playerTurn = true; // enable player input again
    }
  }, 2000);
}

function computerMove(){
  let bestMove = findBestMove();
  if(bestMove !== -1){
    makeMove(bestMove, "O");
  }
}

function makeMove(index, player){
  board[index] = player;
  document.getElementsByClassName("cell")[index].innerText = player;
  checkWinner();
}

function checkWinner(){
  for(let condition of winConditions){
    const [a,b,c] = condition;
    if(board[a] !== "" && board[a] === board[b] && board[a] === board[c]){
      gameActive = false;
      if(board[a] === "X"){
        statusText.innerText = "You Win!";
      } else {
        statusText.innerText = "Computer Wins!";
      }
      restartBtn.style.display = "block";
      return;
    }
  }

  if(!board.includes("")){
    gameActive = false;
    statusText.innerText = "Draw!";
    restartBtn.style.display = "block";
  }
}

function findBestMove(){
  // 1. Win if possible
  for(let condition of winConditions){
    let [a,b,c] = condition;
    let line = [board[a], board[b], board[c]];
    if(line.filter(v => v === "O").length === 2 && line.includes("")){
      return condition[line.indexOf("")];
    }
  }

  // 2. Block player
  for(let condition of winConditions){
    let [a,b,c] = condition;
    let line = [board[a], board[b], board[c]];
    if(line.filter(v => v === "X").length === 2 && line.includes("")){
      return condition[line.indexOf("")];
    }
  }

  // 3. Take center
  if(board[4] === "") return 4;

  // 4. Random move
  let empty = board.map((v,i)=> v===""?i:null).filter(v=>v!==null);
  if(empty.length === 0) return -1;

  return empty[Math.floor(Math.random()*empty.length)];
}

function restartGame(){
  board = ["","","","","","","","",""];
  gameActive = true;
  playerTurn = true; // reset flag
  statusText.innerText = "You choose";
  restartBtn.style.display = "none";

  let cells = document.getElementsByClassName("cell");
  for(let i=0;i<cells.length;i++){
    cells[i].innerText = "";
  }
}
</script>

</body>
</html>
